# 第二部分 项目构建

## 第4章 垂直切片

- 垂直切片的目的：尽快让软件能使用，从用户界面一直打通到数据存储层。
- 活动骨架（本书采用测试驱动开发`TDD`）：
  - 特征测试：针对现有软件的行为特征进行测试编写。
  - AAA模式（预备-执行-断言）
    - 预备阶段（Arrange）：准备好测试所需的一切。
    - 执行阶段（Act）：完成希望测试的动作。
    - 断言阶段（Assert）：验证实际结果是否与预期一致。
  - 文档应该优先解释的是决定的理由，而不是决定的内容。

## 第5章 封装

- 代码改动优先级的原则：不断地提醒开发人员放慢速度，编写生产代码应当被视为对测试或分析器等驱动力的响应。保持小步前进，可以减少出错的概率。

| 指导原则                                             | 说明                   |
|:-------------------------------------------------|:---------------------|
| $\{\} \rightarrow \text{nil}$                    | 从完全没有代码到用到`nil`的代码   |
| $\text{nil} \rightarrow \text{constant}$         | 从`nil`到常量            |
| $\text{constant} \rightarrow \text{constant+}$   | 从简单常量到更复杂的常量         |
| $\text{constant} \rightarrow \text{scalar}$      | 从常量到变量或参数            |
| $\text{statement} \rightarrow \text{statements}$ | 从单条语句到多条无条件判断的语句     |
| $\text{unconditional} \rightarrow \text{if}$     | 从无条件执行到分条件执行         |
| $\text{scalar} \rightarrow \text{array}$         | 从标量到数组               |
| $\text{array} \rightarrow \text{container}$      | 从数组到容器               |
| $\text{statement} \rightarrow \text{recursion}$  | 从普通语句到递归             |
| $\text{if} \rightarrow \text{while}$             | 从`if`到`while`        |
| $\text{expression} \rightarrow \text{function}$  | 从表达式到函数              |
| $\text{variable} \rightarrow \text{assignment}$  | 从变量到赋值               |

- 红绿重构：
  - 红（红灯）：新写一个失败的测试，大多数测试程序会将失败的测试标记为红色。
  - 绿（绿灯）：做尽可能小的改动，以通过所有测试。测试程序通常将通过的测试标记为绿色。
  - 重构：在不变更行为的情况下改进代码。
- 按契约设计：**抽象就是忽略无关紧要的东西，放大本质的东西。**（来自《代码整洁之道》）
- `Postel`定律：**对发送的内容保持审慎，对接收的内容保持宽容。**
- 保护不变量：对象应该保护其不变量，包括前置条件和后置条件。

## 第6章 三角测量

- 短期记忆与长期记忆：短期记忆的容量远小于长期记忆的容量，短期记忆的内容偶尔会进入长期记忆，长期记忆中的信息也可以被检索并加载到短期记忆中。
- 遗留代码和记忆：学习代码库需要时间，修改代码是困难的。
- 恶魔的辩词：故意钻空子，用明显不完整的实现类蒙混过所有的测试。可以用来评估测试套件是否需要更多的测试用例来增加可信度。

## 总结

&emsp;&emsp;在测试驱动开发中，综合使用改动优先级原则、恶魔的辩词、红绿重构过程，达到对所需行为的360°全方位描述。